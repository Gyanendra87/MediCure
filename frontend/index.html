<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MediCure ‚Äî Home Remedies AI</title>
  <style>
    /* ---------- Reset & Body ---------- */
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;padding:20px;color:#111;
    }
    .container{max-width:1200px;margin:0 auto}

    header{text-align:center;color:#fff;margin-bottom:30px}
    h1{font-size:2.4rem;margin-bottom:6px;text-shadow:2px 2px 8px rgba(0,0,0,0.25)}
    .tagline{opacity:.95;color:#f3f6ff}

    /* ---------- Tabs ---------- */
    .tabs{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
    .tab-button{
      flex:1;min-width:150px;padding:14px 20px;background:#fff;border:0;border-radius:10px;
      font-weight:600;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,0.08);
      transition:all .25s
    }
    .tab-button:hover{transform:translateY(-4px)}
    .tab-button.active{background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff}

    .tab-content{
      display:none;background:#fff;border-radius:15px;padding:26px;
      box-shadow:0 10px 30px rgba(0,0,0,0.18);animation:fadeIn .45s
    }
    .tab-content.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    /* ---------- Upload area ---------- */
    .upload-area{
      border:3px dashed rgba(255,255,255,0.15);border-radius:12px;padding:36px;text-align:center;
      background:#f8f9ff;cursor:pointer;transition:all .22s;
    }
    .upload-area:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.08)}
    .upload-area.dragover{background:#e6eeff;border-color:#764ba2;transform:translateY(-2px)}
    .upload-icon{font-size:3rem;margin-bottom:12px}

    .file-info{margin-top:18px;padding:14px;background:#e8f5e9;border-radius:8px;display:none}
    .report-content{margin-top:18px;padding:18px;background:#f5f5f5;border-radius:8px;max-height:420px;overflow:auto;white-space:pre-wrap;font-family:monospace;font-size:.92rem}

    /* ---------- Chat ---------- */
    .chatbot-container{display:flex;flex-direction:column;height:520px}
    .chat-messages{flex:1;overflow:auto;padding:18px;background:#f8f9fa;border-radius:10px;margin-bottom:12px;display:flex;flex-direction:column;gap:12px}
    .message{padding:12px 16px;border-radius:14px;max-width:82%;animation:slideIn .28s}
    @keyframes slideIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    .message.user{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;margin-left:auto;text-align:right}
    .message.bot{background:#fff;border:1px solid #e6e6e6;color:#111}

    .chat-input-area{display:flex;gap:10px}
    .chat-input{flex:1;padding:14px;border-radius:26px;border:2px solid #e6e6e6;font-size:1rem;outline:none}
    .chat-input:focus{border-color:#667eea;box-shadow:0 6px 20px rgba(102,126,234,0.12)}
    .send-button{padding:12px 22px;border-radius:24px;border:0;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:700;cursor:pointer}
    .send-button:hover{transform:translateY(-3px)}

    /* ---------- Remedy Form ---------- */
    .remedy-form{display:grid;gap:18px}
    .form-group{display:flex;flex-direction:column}
    label{font-weight:700;margin-bottom:8px}
    input[type="text"],select,textarea{padding:12px;border-radius:8px;border:2px solid #e6e6e6;font-size:1rem}
    textarea{min-height:100px;resize:vertical}
    .predict-button{padding:14px 22px;border-radius:8px;border:0;background:linear-gradient(135deg,#11998e,#38ef7d);color:#fff;font-weight:700;cursor:pointer;transition:all .25s}
    .predict-button:hover{transform:translateY(-3px)}
    .remedy-results{margin-top:18px;padding:18px;border-radius:10px;background:linear-gradient(135deg,#ffecd2,#fcb69f);display:none}
    .remedy-item{background:#fff;padding:12px;border-radius:8px;margin-bottom:10px;border-left:4px solid #ff6b6b}

    .warning{background:#fff3cd;border-left:4px solid #ffc107;padding:14px;border-radius:8px;margin-top:18px}
    
    .info-box{background:#e3f2fd;border-left:4px solid #2196f3;padding:14px;border-radius:8px;margin-bottom:18px}

    /* ---------- Notification ---------- */
    .notification{position:fixed;top:22px;right:22px;padding:12px 18px;border-radius:10px;color:#fff;font-weight:700;z-index:9999;box-shadow:0 10px 30px rgba(0,0,0,0.18)}
    .note-success{background:linear-gradient(135deg,#00d4aa,#00f2fe)}
    .note-error{background:linear-gradient(135deg,#f5576c,#f093fb)}
    .note-info{background:linear-gradient(135deg,#667eea,#764ba2)}

    /* ---------- Responsive ---------- */
    @media (max-width:900px){
      .tab-button{min-width:120px;padding:12px}
      .chatbot-container{height:420px}
    }
    @media (max-width:620px){
      .tabs{flex-direction:column}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üè• MediCure: Your Personal AI Doctor</h1>
      <p class="tagline">Upload reports, chat with AI, and discover home remedies</p>
    </header>

    <div class="tabs" role="tablist">
      <button class="tab-button active" onclick="switchTab(event,'upload')">üìÑ Upload Report</button>
      <button class="tab-button" onclick="switchTab(event,'remedies')">üåø Home Remedies</button>
      <button class="tab-button" onclick="switchTab(event,'chatbot')">üí¨ Medical Chat</button>
    </div>

    <!-- UPLOAD -->
    <div id="upload" class="tab-content active">
      <h2>Upload Your Medical Report</h2>
      <p style="color:#666;margin:12px 0">Supported: PDF files. Your report will be analyzed by our AI backend.</p>

      <div id="uploadArea" class="upload-area" onclick="triggerFile()">
        <div class="upload-icon">üìÅ</div>
        <h3>Click to select or drag & drop your report</h3>
        <p style="color:#666;margin-top:8px">PDF files only</p>
      </div>

      <input id="fileInput" type="file" accept=".pdf" style="display:none" onchange="handleFile(this.files[0])">

      <div id="fileInfo" class="file-info">
        <strong>Selected File:</strong> <span id="fileName"></span><br>
        <strong>Size:</strong> <span id="fileSize"></span>
      </div>

      <div id="reportContent" class="report-content" style="display:none">
        <strong>Report Analysis:</strong><br><br>
        <div id="reportText"></div>
      </div>

      <div class="warning">
        <strong>‚ö†Ô∏è Privacy Notice:</strong> Your data is processed securely. Ensure compliance with HIPAA/local privacy laws.
      </div>
    </div>

    <!-- REMEDIES -->
    <div id="remedies" class="tab-content">
      <h2>üåø Home Remedy Finder</h2>
      
      <div class="info-box">
        <strong>üí° How it works:</strong> Enter a disease or symptom name, and our AI will search our database of natural home remedies to provide you with effective, time-tested solutions.
      </div>

      <div class="remedy-form">
        <div class="form-group">
          <label for="diseaseInput">Disease or Condition</label>
          <input id="diseaseInput" type="text" placeholder="e.g., headache, cold, fever, acidity, insomnia..." onkeydown="handleRemedyKeypress(event)">
        </div>

        <button class="predict-button" onclick="getRemedies()">üîç Find Home Remedies</button>
      </div>

      <div id="remedyResults" class="remedy-results"></div>

      <div class="warning" style="margin-top:18px">
        <strong>‚ö†Ô∏è Important:</strong> Home remedies are complementary. Seek professional medical care for serious or persistent symptoms.
      </div>
    </div>

    <!-- CHATBOT -->
    <div id="chatbot" class="tab-content">
      <h2>Medical AI Assistant</h2>
      
      <div class="info-box">
        <strong>üí¨ Ask anything:</strong> Get answers about diseases, symptoms, treatments, or follow up on your uploaded report. This chatbot uses AI to provide general medical information.
      </div>

      <div class="chatbot-container">
        <div id="chatMessages" class="chat-messages" aria-live="polite">
          <div class="message bot">Hello! I'm your medical AI assistant. Ask me about diseases, symptoms, treatments, or your uploaded report.</div>
        </div>

        <div class="chat-input-area">
          <input id="chatInput" class="chat-input" type="text" placeholder="Ask a medical question..." onkeydown="handleChatKeypress(event)">
          <button class="send-button" onclick="sendMessage()">Send</button>
        </div>
      </div>

      <div class="warning" style="margin-top:16px">
        <strong>‚ö†Ô∏è Medical Disclaimer:</strong> This chatbot provides general information only and is not a replacement for professional medical advice, diagnosis, or treatment.
      </div>
    </div>

  </div>

  <script>
    const API_BASE = 'http://127.0.0.1:8000';

    /***********************
     * Authentication Check
     ***********************/
    let token = localStorage.getItem('jwt_token');
    if(!token){
      window.location.href = 'login.html';
    }

    function getAuthHeaders(){
      return { 'Authorization': `Bearer ${token}` };
    }

    /***********************
     * Utility & UI Helpers
     ***********************/
    function showNotification(text,type='info'){
      const existing = document.querySelector('.notification');
      if(existing) existing.remove();
      const div = document.createElement('div');
      div.className = 'notification ' + (type==='success'?'note-success':type==='error'?'note-error':'note-info');
      div.textContent = text;
      document.body.appendChild(div);
      setTimeout(()=>div.remove(),3500);
    }

    function switchTab(ev,tabId){
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      if(ev && ev.currentTarget) ev.currentTarget.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      if(tabId==='chatbot') setTimeout(()=>document.getElementById('chatInput').focus(),80);
      if(tabId==='remedies') setTimeout(()=>document.getElementById('diseaseInput').focus(),80);
    }

    function triggerFile(){ document.getElementById('fileInput').click(); }

    /***********************
     * Drag & Drop for Upload
     ***********************/
    const uploadArea = document.getElementById('uploadArea');
    ['dragenter','dragover','dragleave','drop'].forEach(ev=>{
      uploadArea.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();});
    });
    ['dragenter','dragover'].forEach(ev=>{uploadArea.addEventListener(ev,()=>uploadArea.classList.add('dragover'));});
    ['dragleave','drop'].forEach(ev=>{uploadArea.addEventListener(ev,()=>uploadArea.classList.remove('dragover'));});
    uploadArea.addEventListener('drop',e=>{
      const files = e.dataTransfer.files;
      if(files.length) handleFile(files[0]);
    });

    /***********************
     * File Handling
     ***********************/
    function bytesToKB(n){ return (n/1024).toFixed(2)+' KB'; }

    async function handleFile(file){
      if(!file) return;
      if(!file.name.toLowerCase().endsWith('.pdf')) { showNotification('‚ùå Please select a PDF file','error'); return; }

      document.getElementById('fileInfo').style.display='block';
      document.getElementById('fileName').textContent = file.name;
      document.getElementById('fileSize').textContent = bytesToKB(file.size);

      const reportTextEl = document.getElementById('reportText');
      document.getElementById('reportContent').style.display='block';
      reportTextEl.textContent = '‚è≥ Uploading and analyzing report...';
      showNotification('‚è≥ Uploading report...','info');

      const formData = new FormData();
      formData.append("file",file);

      try{
        const response = await fetch(`${API_BASE}/report/upload`,{
          method:'POST',
          body:formData,
          headers:getAuthHeaders()
        });
        const data = await response.json();
        if(data.summary){
          reportTextEl.textContent = data.summary;
          showNotification('‚úÖ Report analyzed successfully!','success');
        } else if(data.error){
          reportTextEl.textContent = "‚ö† "+data.error;
          showNotification('‚ùå Error analyzing report','error');
        }
      } catch(err){
        reportTextEl.textContent = "‚ö† Server not responding!";
        showNotification('‚ùå Server not responding','error');
      }
    }

    /***********************
     * Chatbot
     ***********************/
    function appendChatMessage(text,isUser=false){
      const chatMessages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'message '+(isUser?'user':'bot');
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function sendMessage(){
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if(!text) return;

      appendChatMessage(text,true);
      input.value = '';
      appendChatMessage('‚è≥ Thinking...',false);

      try{
        const response = await fetch(`${API_BASE}/chat/ask?query=${encodeURIComponent(text)}`,{
          headers:getAuthHeaders()
        });
        const data = await response.json();
        const messages = document.getElementById('chatMessages');
        messages.removeChild(messages.lastChild);

        if(data.answer) appendChatMessage(data.answer,false);
        else if(data.error) appendChatMessage("‚ö† "+data.error,false);
      } catch(err){
        const messages = document.getElementById('chatMessages');
        messages.removeChild(messages.lastChild);
        appendChatMessage("‚ö† Server not responding!",false);
      }
    }

    function handleChatKeypress(e){ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); } }

    /***********************
     * Home Remedies
     ***********************/
    async function getRemedies(){
      const disease = document.getElementById('diseaseInput').value.trim();
      if(!disease){ showNotification('‚ö†Ô∏è Please enter a disease or condition name','error'); return; }

      const resDiv = document.getElementById('remedyResults');
      resDiv.innerHTML = '<p style="text-align:center">üîç Searching our home remedies database...</p>';
      resDiv.style.display='block';

      try{
        const response = await fetch(`${API_BASE}/chat/ask?query=home remedies for ${encodeURIComponent(disease)}`,{
          headers:getAuthHeaders()
        });
        const data = await response.json();
        if(data.answer){
          const formattedAnswer = data.answer.replace(/\n/g,'<br>');
          resDiv.innerHTML = `<h3>üåø Home Remedies for "${disease}"</h3><div class="remedy-item">${formattedAnswer}</div>`;
          showNotification('‚úÖ Remedies found!','success');
        } else if(data.error){
          resDiv.innerHTML = `<p style="text-align:center">‚ö† ${data.error}</p>`;
          showNotification('‚ùå Error fetching remedies','error');
        }
      } catch(err){
        resDiv.innerHTML = '<p style="text-align:center">‚ö† Server not responding!</p>';
        showNotification('‚ùå Server not responding','error');
      }
      resDiv.scrollIntoView({behavior:'smooth',block:'nearest'});
    }

    function handleRemedyKeypress(e){ if(e.key==='Enter'){ e.preventDefault(); getRemedies(); } }

    /***********************
     * Logout
     ***********************/
    function logout(){
      localStorage.removeItem('jwt_token');
      window.location.href='login.html';
    }

    /***********************
     * Startup
     ***********************/
    window.addEventListener('load',()=>{
      showNotification('üëã MediCure loaded! Backend should be running on port 8000','info');
    });
  </script>
</body>
</html>
